@startuml JavaEatsLite ERD
!theme plain

' ======================
' CORE ENTITIES
' ======================

entity user {
    *user_id : ULID <<PK>>
    --
    role_id : bigint <<FK>>
    username : varchar
    password_hash : varchar
    email : varchar
    last_login_at : timestamp
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

entity role {
    *role_id : bigint <<PK>>
    --
    role_name : varchar
    description : text
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

entity device {
    *device_id : UUID <<PK>>
    --
    user_id : ULID <<FK>>
    device_type : varchar
    os : varchar
    app_version : varchar
    status : varchar
    last_active_at : timestamp
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

entity customer {
    *customer_id : ULID <<PK>>
    --
    user_id : ULID <<FK>>
    name : varchar
    email : varchar
    phone : varchar
    device_id : UUID <<FK>>
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

' ======================
' RESTAURANT & MENU
' ======================

entity restaurant_category {
    *restaurant_category_id : ULID <<PK>>
    --
    name : varchar
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

entity restaurant {
    *restaurant_id : ULID <<PK>>
    --
    restaurant_category_id : ULID <<FK>>
    name : varchar
    location : geometry
    status : varchar
    address : varchar
    phone : varchar
    description : text
    start_time : timestamp
    close_time : timestamp
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

entity menu {
    *menu_id : ULID <<PK>>
    --
    restaurant_id : ULID <<FK>>
    name : varchar
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

entity menu_category {
    *menu_category_id : ULID <<PK>>
    --
    menu_id : ULID <<FK>>
    name : varchar
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

entity menu_item {
    *menu_item_id : ULID <<PK>>
    --
    menu_id : ULID <<FK>>
    menu_category_id : ULID <<FK>>
    name : varchar
    description : text
    price : decimal
    available : boolean
    image_url : varchar
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

entity ingredient {
    *ingredient_id : ULID <<PK>>
    --
    menu_item_id : ULID <<FK>>
    name : varchar
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

entity review {
    *review_id : ULID <<PK>>
    --
    restaurant_id : ULID <<FK>>
    customer_id : ULID <<FK>>
    rating : int
    comment : text
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

' ======================
' CART MANAGEMENT
' ======================

entity cart {
    *cart_id : bigint <<PK>>
    --
    customer_id : ULID <<FK>>
    status : varchar
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

entity cart_item {
    *cart_item_id : bigint <<PK>>
    --
    cart_id : bigint <<FK>>
    menu_item_id : ULID <<FK>>
    quantity : int
    price : decimal
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

' ======================
' ORDER MANAGEMENT
' ======================

entity "order" as order {
    *order_id : ULID <<PK>>
    --
    customer_id : ULID <<FK>>
    restaurant_id : ULID <<FK>>
    total_amount : decimal
    status_id : bigint <<FK>>
    customer_name : varchar
    restaurant_name : varchar
    payment_method_snapshot : varchar
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

entity order_item {
    *order_item_id : ULID <<PK>>
    --
    order_id : ULID <<FK>>
    menu_item_id : ULID <<FK>>
    quantity : int
    price : decimal
    menu_item_name : varchar
    menu_item_price : decimal
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

entity order_status {
    *status_id : bigint <<PK>>
    --
    name : varchar
    description : text
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

' ======================
' ADDRESSES
' ======================

entity address {
    *address_id : ULID <<PK>>
    --
    customer_id : ULID <<FK>>
    address_line1 : varchar
    address_line2 : varchar
    location : geometry
    city : varchar
    state : varchar
    postal_code : varchar
    country : varchar
    is_default : boolean
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

' ======================
' PAYMENTS (SECURED)
' ======================

entity preferred_payment_setting {
    *preferred_payment_id : ULID <<PK>>
    --
    customer_id : ULID <<FK>>
    payment_type_id : ULID <<FK>>
    payment_config_id : ULID <<FK>>
    alias : varchar
    token_id : varchar
    is_default : boolean
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

entity transaction {
    *transaction_id : ULID <<PK>>
    --
    order_id : ULID <<FK>>
    customer_id : ULID <<FK>>
    amount : decimal
    payment_status_id : ULID <<FK>>
    payment_type_id : ULID <<FK>>
    provider_reference : varchar
    raw_request : jsonb
    raw_response : jsonb
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

entity payment_integration_type {
    *payment_type_id : ULID <<PK>>
    --
    name : varchar
    provider : varchar
    supports_tokenization : boolean
    description : text
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

entity payment_integration_configuration {
    *payment_config_id : ULID <<PK>>
    --
    payment_type_id : ULID <<FK>>
    merchant_id : varchar
    api_key_enc : varchar
    secret_key_enc : varchar
    terminal_id : varchar
    region : varchar
    active : boolean
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

entity payment_status {
    *payment_status_id : ULID <<PK>>
    --
    name : varchar
    description : text
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

' ======================
' AUDITING
' ======================

entity auditing {
    *audit_id : ULID <<PK>>
    --
    entity_type : varchar
    entity_id : ULID
    transaction_id : ULID <<FK>>
    user_id : ULID <<FK>>
    action : varchar
    previous_state : varchar
    new_state : varchar
    provider_request : jsonb
    provider_response : jsonb
    details : jsonb
    device_id : UUID <<FK>>
    ip_address : varchar
    created_at : timestamp
    updated_at : timestamp
    created_by : ULID <<FK>>
    updated_by : ULID <<FK>>
    is_active : boolean
    deleted_at : timestamp
    deleted_by : ULID <<FK>>
}

' ======================
' RELATIONSHIPS
' ======================

role ||--o{ user
user ||--o{ device

user ||--o{ customer
restaurant_category ||--o{ restaurant
restaurant ||--o{ menu
menu ||--o{ menu_category
menu ||--o{ menu_item
menu_category ||--o{ menu_item
menu_item ||--o{ ingredient
restaurant ||--o{ review
customer ||--o{ review

customer ||--o{ cart
cart ||--o{ cart_item
cart_item }o--|| menu_item

customer ||--o{ order
restaurant ||--o{ order
order ||--o{ order_item
order_item }o--|| menu_item
order }o--|| order_status

customer ||--o{ address

customer ||--o{ preferred_payment_setting
preferred_payment_setting }o--|| payment_integration_type
preferred_payment_setting }o--|| payment_integration_configuration

order ||--o{ transaction
transaction }o--|| payment_status
transaction }o--|| payment_integration_type

auditing }o--|| user
auditing }o--|| device
auditing }o--|| transaction

@enduml